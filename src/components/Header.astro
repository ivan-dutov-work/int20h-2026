---
import { Image } from "astro:assets";
import logo from "@/assets/logo.svg";
import burgerMenu from "@/assets/menu/burger-menu.png";
import arrowDown from "@/assets/menu/arrow-down.png";
const NAV_LINKS = [
  { href: "#about", label: "Про проєкт" },
  { href: "#categories", label: "Категорії" },
  { href: "#how-to", label: "Умови участі" },
  { href: "#about-us", label: "Про нас" },
  { href: "#faq", label: "FAQ" },
];
---

<header
  class="px-6 md:px-8 py-2 flex md:flex-col lg:flex-row justify-between gap-4 items-center bg-brand-gray sticky top-0 w-full z-50"
>
  <Image
    src={logo}
    alt="INT20H Logo"
    class="md:w-1/2 lg:w-fit"
    loading="eager"
    fetchpriority="high"
  />

  <!-- Desktop Menu -->
  <ul class="hidden md:flex flex-row gap-8">
    {
      NAV_LINKS.map((link) => (
        <li>
          <a
            href={link.href}
            class="font-pixelated capitalize text-sm hover:text-accent transition-colors"
          >
            {link.label}
          </a>
        </li>
      ))
    }
  </ul>

  <!-- Mobile Menu Button -->
  <button
    id="mobile-menu-button"
    class="md:hidden p-2"
    aria-label="Toggle menu"
    data-burger-src={burgerMenu.src}
    data-arrow-src={arrowDown.src}
  >
    <Image
      id="menu-icon"
      src={burgerMenu}
      alt="Menu"
      class="w-8 h-8"
      loading="eager"
    />
  </button>

  <!-- Mobile Menu Dropdown -->
  <div
    id="mobile-menu"
    class="absolute top-full left-0 right-0 bg-brand-gray z-50 md:hidden hidden shadow-lg"
  >
    <ul class="flex flex-col py-4">
      {
        NAV_LINKS.map((link) => (
          <li>
            <a
              href={link.href}
              class="mobile-menu-link font-pixelated capitalize text-lg px-8 py-3 block hover:text-accent hover:bg-brand-dark transition-colors text-right md:text-left"
            >
              {link.label}
            </a>
          </li>
        ))
      }
    </ul>
  </div>
</header>

<script>
  // Mobile menu functionality
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");
  const menuIcon = document.getElementById("menu-icon") as HTMLImageElement;
  const mobileMenuLinks = document.querySelectorAll(".mobile-menu-link");

  // Get the processed image URLs from data attributes
  const burgerSrc = mobileMenuButton?.getAttribute("data-burger-src") || "";
  const arrowSrc = mobileMenuButton?.getAttribute("data-arrow-src") || "";

  let isMenuOpen = false;

  // Toggle mobile menu
  const toggleMenu = () => {
    isMenuOpen = !isMenuOpen;

    if (isMenuOpen) {
      mobileMenu?.classList.remove("hidden");
      // Change icon to arrow-down
      if (menuIcon) {
        menuIcon.src = arrowSrc;
        menuIcon.alt = "Close menu";
      }
    } else {
      mobileMenu?.classList.add("hidden");
      // Change icon back to burger-menu
      if (menuIcon) {
        menuIcon.src = burgerSrc;
        menuIcon.alt = "Menu";
      }
    }
  };

  mobileMenuButton?.addEventListener("click", toggleMenu);

  // Close menu when clicking on a link and scroll to section
  mobileMenuLinks.forEach((link) => {
    link.addEventListener("click", (e) => {
      e.preventDefault();
      const href = link.getAttribute("href");
      if (href) {
        if (isMenuOpen) {
          toggleMenu();
        }
        // Smooth scroll to section
        const target = document.querySelector(href);
        if (target) {
          target.scrollIntoView({ behavior: "smooth" });
        }
      }
    });
  });

  // Also add smooth scrolling to desktop links
  document.querySelectorAll('header a[href^="#"]').forEach((link) => {
    if (!link.classList.contains("mobile-menu-link")) {
      link.addEventListener("click", (e) => {
        e.preventDefault();
        const href = link.getAttribute("href");
        if (href) {
          const target = document.querySelector(href);
          if (target) {
            target.scrollIntoView({ behavior: "smooth" });
          }
        }
      });
    }
  });

  // Close menu when clicking outside
  document.addEventListener("click", (e) => {
    const target = e.target as HTMLElement;

    // Check if click is outside the menu and button
    if (
      isMenuOpen &&
      mobileMenu &&
      mobileMenuButton &&
      !mobileMenu.contains(target) &&
      !mobileMenuButton.contains(target)
    ) {
      toggleMenu();
    }
  });
</script>
